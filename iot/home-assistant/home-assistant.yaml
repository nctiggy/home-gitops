---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: home-assistant
  namespace: iot
  annotations:
    fluxcd.io/automated: "true"
    filter.fluxcd.io/chart-image: semver:~0.
spec:
  releaseName: home-assistant
  rollback:
    enable: true
  chart:
    repository: https://billimek.com/billimek-charts/
    name: home-assistant
    version: 1.2.0
  values:
    image:
      repository: homeassistant/home-assistant
      tag: 0.115.6
    persistence:
      enabled: true
      #      existingClaim: home-assistant
    service:
      type: LoadBalancer
      loadBalancerIP: 192.168.0.53
    hostNetwork: true
    probes:
      liveness:
        enabled: false
      readiness:
        enabled: false
    podAnnotations:
      backup.velero.io/backup-volumes: config
    monitoring:
      enabled: false
    postgresql:
      enabled: true
      global:
        postgresql:
          postgresqlUsername: home-assistant
          postgresqlDatabase: home-assistant
      persistence:
        enabled: true
        #        existingClaim: home-assistant-postgresql
    configurator:
      enabled: true
      ingress:
        enabled: false
  valueFileSecrets:
  - name: "home-assistant-values"
